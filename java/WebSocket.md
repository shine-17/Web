# WebSocket

### 웹소켓은 하나의 TCP 접속에 전이중(양방향) 통신 채널을 제공하는 컴퓨터 통신 프로토콜   

#### 클라이언트의 요청에 대해서만 응답을 보내는 HTTP를 이용한 실시간 통신의 문제를 해결하기 위해 웹소켓이 등장했다.   
* 웹소켓은 실시간 양방향 통신을 지원하며 한번 연결이 수립되면 클라이언트와 서버 모두 자유롭게 데이터를 보낼 수 있다.
* 채팅과 같은 연속적인 통신에 대해 계속 유사한 통신을 반복하지 않게 해주어 통신의 효율성도 개선했다.   

웹소켓은 HTTP와 같은 OSI 모델의 7계층에 위치하는 프로토콜이며, 4계층의 TCP에 의존한다.

### HTTP 프로토콜을 이용할 때 "http"를 이용하는 것처럼,
### 웹소켓을 이용할 때 "ws"를 이용한다.
### 또한 보완을 강화한 "https"를 사용하는 것처럼
### "ws"에 대해 보완을 강화한 "wss"를 사용할 수 있다.
<hr/>

HTTP를 이용해서 연결을 수립하며 연결된 이후에도 연결을 할 때 사용했던 포트인 80과 433포트를 이용한다.   
연결 수립은 핸드쉐이크를 통해 이루어지며 핸드쉐이크시 HTTP를 이용한다.

![image](https://user-images.githubusercontent.com/37826908/120201182-1c288a80-c260-11eb-81b6-9faebe66a8ed.png)   

핸드쉐이크는 한번의 HTTp 요청과 HTTP 응답으로 이루어진다.   
핸드쉐이크가 끝나면 HTTP 프로토콜을 웹소켓 프로토콜로 변환하여 통신을 하는 구조이다.   
   
핸드쉐이크는 먼저 클라이언트가 HTTP로 웹소켓 연결 요청을 하면서 시작되고,   
웹소켓 연결 요청에는 "Connection:Upgrade"와 "Upgrade:websocket" 헤더를 통해 웹소켓 요청임을 표시한다.   
또한 "Sec-WebSocket-Key" 헤더를 통해 핸드쉐이크 응답을 검증할 키 값을 보낸다.   
그 외에도 WebSocket 연결시 보조로 이용할 프로토콜 정보등의 추가적인 정보를 헤더에 담아 보낼 수 있다.   

### 웹소켓 연결 요청 예시   
![image](https://user-images.githubusercontent.com/37826908/120202769-f2706300-c261-11eb-8661-5e65c76af08f.png)   

이에 대한 서버의 응답역시 HTTP로 온다. 정상적인 응답의 상태코드는 101(Switching Protocols)이다.   
"Sec-WebSocket-Key" 헤더를 통해 받은 값에 특정 값을 붙인 후, SHA-1로 해싱하고 base64로 인코딩한 값을       
"Sec-WebSocket-Key" 헤더에 보낸다. 이 값을 통해 클라이언트는 정상적인 핸드쉐이크 과정을 검증한다.   
클라이언트가 정상적으로 응답을 받으면 핸드쉐이크는 종료되고 이후부터 웹소켓 프로토콜을 통해 데이터 통신을 한다.   

### 웹소켓 연결 요청에 대한 응답 예시   
![image](https://user-images.githubusercontent.com/37826908/120203222-70cd0500-c262-11eb-9f12-475b4bdbb665.png)

이와 같이 핸드쉐이크가 끝나면 웹소켓 프로토콜을 통해 텍스트를 주고 받을 수 있게 된다.

참고 : https://woowacourse.github.io/javable/post/2020-09-20-websocket/
